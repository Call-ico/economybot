# Интеграция Stats-бота в основной проект

## Что было сделано

### 1. Создан новый Cog для stats-функционала
- **Файл**: `cogs/stats_cog.py`
- **Функция**: Интегрирует команду `/stats` в основной бот
- **Импорты**: Использует `pparser.py` из папки `stats/`

### 2. Обновлены зависимости
- **Файл**: `requirements.txt`
- **Добавлены**:
  - `requests>=2.28.0`
  - `beautifulsoup4>=4.11.0`
  - `aiofiles>=23.0.0`
  - `aiohttp>=3.8.0`

### 3. Отключен отдельный запуск stats-бота
- **Файл**: `stats/bot.py`
- **Изменения**:
  - Удален импорт TOKEN из config.py
  - Закомментирована функция команды `/stats`
  - Закомментирован запуск отдельного бота
  - Оставлены только вспомогательные функции

### 4. Удален файл с токеном
- **Файл**: `stats/config.py` - удален
- **Причина**: Токен теперь берется из `modules/config.py`

## Структура после интеграции

```
economy bot/
├── main.py                    # Основной запуск бота
├── base.py                    # Базовая конфигурация
├── modules/
│   └── config.py              # Единый источник токена
├── cogs/
│   ├── stats_cog.py           # НОВЫЙ: Stats функционал
│   ├── economy.py             # Существующие cogs
│   ├── activity.py
│   └── ...
├── stats/                     # Папка с ресурсами stats
│   ├── bot.py                 # Вспомогательные функции (без запуска)
│   ├── pparser.py             # Парсер статистики
│   ├── ui.png                 # UI изображения
│   ├── arial.ttf              # Шрифты
│   └── ...
└── requirements.txt           # Обновленные зависимости
```

## Команды

### Доступные команды:
- `/статистика` - оригинальная статистика экономики
- `/stats` - НОВАЯ: статистика игроков ICCup

### Различия:
- `/статистика` - показывает экономическую статистику сервера
- `/stats` - показывает статистику игрока Dota 2 с ICCup

## Запуск

1. **Установите зависимости**:
   ```bash
   pip install -r requirements.txt
   ```

2. **Настройте токен** в `.env` файле:
   ```
   TOKEN=ваш_токен_бота
   COMMAND_PREFIX=!
   FILENAME=economy.db
   ```

3. **Запустите бота**:
   ```bash
   python main.py
   ```

## Особенности интеграции

### Пути к файлам
- Все пути к ресурсам в `stats_cog.py` указывают на папку `stats/`
- Например: `"stats/ui.png"`, `"stats/arial.ttf"`

### Кэширование
- Сохранен механизм кэширования изображений
- Кэш работает в рамках одного процесса

### Обработка ошибок
- Добавлена обработка ошибок при загрузке ресурсов
- Fallback на стандартные шрифты при отсутствии файлов

## Проверка работы

1. Запустите бота
2. Проверьте команду `/stats никнейм` (например: `/stats Dendi`)
3. Убедитесь, что команда `/статистика` также работает
4. Проверьте, что обе команды не конфликтуют

## Возможные проблемы

### Отсутствуют файлы ресурсов
Если отсутствуют файлы в папке `stats/`:
- `ui.png` - фоновое изображение
- `arial.ttf` - шрифт
- `online.png`, `offline.png`, `unknown.jpg` - иконки статуса
- `elite.png` - иконка элитного статуса

**Решение**: Бот будет использовать стандартные шрифты и пропускать отсутствующие изображения.

### Ошибки парсинга
Если сайт ICCup недоступен или изменил структуру:
**Решение**: Команда вернет сообщение об ошибке.

## Дополнительные возможности

### Добавление новых команд
Для добавления новых команд из stats-проекта:
1. Создайте новые методы в `StatsCog` классе
2. Используйте декоратор `@app_commands.command`
3. Импортируйте нужные функции из `stats/bot.py`

### Модификация UI
Для изменения внешнего вида статистики:
1. Отредактируйте функции рисования в `stats_cog.py`
2. Измените файлы изображений в папке `stats/`
3. Обновите координаты и размеры в коде 